generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id          String   @id @default(uuid())
  sku         String   @unique
  name        String
  description String?
  status      String   @default("draft") // draft, active, archived
  
  categoryId  String?
  category    Category? @relation(fields: [categoryId], references: [id])

  variants    ProductVariant[]
  attributes  ProductAttributeValue[]
  channelContent ProductChannelContent[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("pim_products")
}

model ProductVariant {
  id        String   @id @default(uuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  
  sku       String   @unique
  name      String?
  
  attributes ProductAttributeValue[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_variants")
}

model Category {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  parentId  String?
  parent    Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children  Category[] @relation("CategoryHierarchy")
  
  products  Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_categories")
}

model Attribute {
  id        String   @id @default(uuid())
  name      String   @unique
  type      String   // text, number, select, boolean
  options   String[] // for select type
  
  values    ProductAttributeValue[]

  @@map("pim_attributes")
}

model ProductAttributeValue {
  id          String   @id @default(uuid())
  productId   String?
  product     Product? @relation(fields: [productId], references: [id])
  variantId   String?
  variant     ProductVariant? @relation(fields: [variantId], references: [id])
  
  attributeId String
  attribute   Attribute @relation(fields: [attributeId], references: [id])
  
  value       String

  @@map("pim_attribute_values")
}

model ProductChannelContent {
  id          String   @id @default(uuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  
  channelId   String   // allegro, amazon, shop
  title       String?
  description String?
  bulletPoints String[]
  
  status      String   @default("draft") // draft, synced, error

  updatedAt   DateTime @updatedAt

  @@unique([productId, channelId])
  @@map("pim_channel_content")
}
