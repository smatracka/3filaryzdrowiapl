generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// CORE PRODUCT MODEL
// ============================================

model Product {
  id     String        @id @default(uuid())
  sku    String        @unique
  ean    String?       @unique
  brand  String
  name   String
  type   ProductType
  status ProductStatus @default(DRAFT)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  variants        ProductVariant[]
  supplementAttrs SupplementAttributes?
  foodAttrs       FoodAttributes?
  cosmeticAttrs   CosmeticAttributes?
  deviceAttrs     DeviceAttributes?

  aiContent       AIContent?
  channels        ChannelContent[]
  seo             SEO?
  media           Media?
  logistics       Logistics?
  priceInfo       PriceInfo?
  inventoryRef    InventoryRef?
  healthRelations HealthRelations?
  versioning      Versioning?

  @@map("pim_products")
}

model ProductVariant {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  sku       String        @unique
  ean       String?
  size      String?
  dose      String?
  weight    Float?
  volume    Float?
  color     String?
  unitCount Int?
  gtin      String?
  mpn       String?
  status    ProductStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_variants")
}

// ============================================
// PRODUCT TYPE ATTRIBUTES
// ============================================

model SupplementAttributes {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  form              String
  servings          Int
  servingSize       String
  flavor            String?
  dietTypes         String[] // vegan, gluten-free, etc.
  allergens         String[]
  healthBenefits    String[]
  usageInstructions String
  warnings          String

  ingredients IngredientEntry[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_supplement_attributes")
}

model IngredientEntry {
  id           String               @id @default(uuid())
  supplementId String
  supplement   SupplementAttributes @relation(fields: [supplementId], references: [id], onDelete: Cascade)

  name              String
  dosage            String
  dailyValuePercent Float?
  form              String?
  linkedBiomarkers  String[] // IDs from biomarker_meta
  linkedHealthAreas String[] // ENERGY, SLEEP, STRESS, etc.

  createdAt DateTime @default(now())

  @@map("pim_ingredient_entries")
}

model FoodAttributes {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  nutritionalValues Json // {kcal, protein, fat, carbs, fiber, sugar, salt}
  storage           String
  expiry            DateTime?
  allergens         String[]
  organic           Boolean   @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_food_attributes")
}

model CosmeticAttributes {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  forSkinType      String[] // dry, oily, combination, sensitive
  forHairType      String[] // dry, oily, normal, damaged
  application      String
  ingredientsINCI  String[] // INCI nomenclature
  dermatologyTests String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_cosmetic_attributes")
}

model DeviceAttributes {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  model         String
  power         String
  materials     String[]
  warranty      String
  includedItems String[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_device_attributes")
}

// ============================================
// AI CONTENT
// ============================================

model AIContent {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  shortDescription String   @db.Text
  longDescription  String   @db.Text
  features         String[]
  benefits         String[]
  aiSummary        String   @db.Text
  aiSellingPoints  String[]
  tone             String // professional, friendly, technical
  faqs             Json // [{question, answer}]
  sourceLLM        String // gpt-4, claude-3, etc.
  aiVersion        String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_ai_content")
}

// ============================================
// CHANNEL CONTENT
// ============================================

model ChannelContent {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  channel           ChannelType
  title             String
  shortDescription  String      @db.Text
  longDescription   String      @db.Text
  bulletPoints      String[]
  legalNotes        String?     @db.Text
  keywords          String[]
  categoryMapping   String // Channel-specific category ID
  attributesMapping Json // {allegroParamId: value}

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([productId, channel])
  @@map("pim_channel_content")
}

// ============================================
// SEO
// ============================================

model SEO {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  focusKeyword    String
  seoTitle        String
  metaDescription String @db.Text
  slug            String @unique
  imageAlt        String
  richSnippets    Json // Structured data for rich results

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_seo")
}

// ============================================
// MEDIA
// ============================================

model Media {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  mainImage String
  gallery   String[]
  videos    String[]
  model3d   String?
  pdfs      String[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_media")
}

// ============================================
// LOGISTICS
// ============================================

model Logistics {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  weight           Float // kg
  height           Float // cm
  width            Float // cm
  depth            Float // cm
  hsCode           String? // Harmonized System Code
  deliveryTime     String // "1-2 days", "3-5 days"
  storageCondition String? // "room temperature", "refrigerated"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_logistics")
}

// ============================================
// PRICING
// ============================================

model PriceInfo {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  retailPrice         Float
  suggestedPromoPrice Float?
  currency            String @default("PLN")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_price_info")
}

// ============================================
// INVENTORY
// ============================================

model InventoryRef {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  sku            String
  allowBackorder Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_inventory_ref")
}

// ============================================
// HEALTH RELATIONS (Harmonia 360Â°)
// ============================================

model HealthRelations {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  linkedIngredients      String[] // Ingredient names
  linkedSymptoms         String[] // fatigue, insomnia, anxiety
  linkedHealthAreas      String[] // ENERGY, SLEEP, STRESS, IMMUNITY, DIGESTION
  linkedBiomarkers       String[] // IDs from biomarker_meta (vitamin_d3, magnesium, etc.)
  contraindications      String[] // pregnancy, kidney_disease, etc.
  recommendedForSegments String[] // SLEEP_LOW, IMMUNITY_LOW, STRESS_HIGH

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_health_relations")
}

// ============================================
// VERSIONING & WORKFLOW
// ============================================

model Versioning {
  id        String  @id @default(uuid())
  productId String  @unique
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  version        Int            @default(1)
  lastEditedBy   String
  workflowStatus WorkflowStatus @default(DRAFT)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pim_versioning")
}

// ============================================
// ENUMS
// ============================================

enum ProductType {
  SIMPLE
  VARIANT
  BUNDLE
  SERVICE
}

enum ProductStatus {
  ACTIVE
  DRAFT
  ARCHIVED
}

enum ChannelType {
  SHOP
  ALLEGRO
  ERLI
  AMAZON
  GMC
}

enum WorkflowStatus {
  DRAFT
  REVIEW
  APPROVED
}
